<div class="dashboard-container">
  <!-- Toast for messages -->
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Header Section -->
  <div class="header">
    <div class="flex justify-between items-center">
      <div>
        <h1>Welcome back, {{ getUserDisplayName() }}!</h1>
        <p>Here's what's happening with your cleaning services today</p>
      </div>
      <div class="flex items-center gap-2">
        <div class="text-right mr-4">
          <div class="text-sm text-gray-500">Logged in as</div>
          <div class="font-semibold">{{ getUserDisplayName() }}</div>
        </div>
        <button 
          pButton 
          icon="pi pi-refresh" 
          label="Refresh" 
          class="p-button-outlined p-button-secondary"
          (click)="refreshDashboard()"
          [disabled]="loading"
        ></button>
      </div>
    </div>
  </div>

  <!-- Metrics Cards -->
  <div class="metrics-grid">
    <p-card *ngFor="let metric of metrics" class="metric-card">
      <div class="metric-content">
        <div class="metric-icon" style="background-color: #0957A1;">
          <i class="pi {{metric.icon}}"></i>
        </div>
        <div class="metric-details">
          <h3>{{metric.title}}</h3>
          <div class="metric-value">{{metric.value}}</div>
          <div *ngIf="metric.subValue" class="metric-subvalue">Total: {{metric.subValue}}</div>
          <button 
            pButton 
            pRipple 
            type="button" 
            [label]="metric.action" 
            class="p-button-text p-button-sm view-button"
            (click)="onMetricAction(metric)"
          ></button>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Recent Bookings Section -->
  <div class="section">
    <div class="section-header">
      <h2>Recent Bookings</h2>
      <span class="text-sm text-gray-500" *ngIf="recentBookings.length > 0">
        Showing {{recentBookings.length}} recent bookings
      </span>
    </div>
    <p-table 
      [value]="recentBookings" 
      [tableStyle]="{'min-width': '60rem'}" 
      styleClass="p-datatable-gridlines" 
      responsiveLayout="scroll"
      [loading]="loading"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>BOOKING ID</th>
          <th>CUSTOMER</th>
          <th>SERVICE</th>
          <th>DATE & TIME</th>
          <th>CLEANER</th>
          <th>STATUS</th>
          <th>ACTIONS</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-booking>
        <tr>
          <td>
            <a class="clickable-bold" (click)="onBookingClick(booking.id.toString())">
              {{formatBookingId(booking)}}
            </a>
          </td>
          <td>
            <div>
              <div class="font-semibold">{{booking.customer_name}}</div>
              <div class="text-sm text-gray-500">{{booking.customer_email}}</div>
            </div>
          </td>
          <td>{{booking.service_name}}</td>
          <td>{{formatDateTime(booking)}}</td>
          <td>
            <a class="clickable-bold" (click)="onCleanerClick(booking.assign_cleaner)">
              {{getCleanerDisplayName(booking.assign_cleaner)}}
            </a>
          </td>
          <td>
            <p-tag 
              [value]="getBookingStatusDisplay(booking)" 
              [severity]="statusSeverity[booking.status]"
            ></p-tag>
          </td>
          <td>
            <div class="action-buttons">
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-eye" 
                class="p-button-text p-button-sm action-button view" 
                pTooltip="View Details" 
                tooltipPosition="top" 
                (click)="onViewBooking(booking)"
              ></button>
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-pencil" 
                class="p-button-text p-button-sm action-button edit"
                pTooltip="Edit Booking" 
                tooltipPosition="top" 
                (click)="onEditBooking(booking)"
              ></button>
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-trash" 
                class="p-button-text p-button-sm action-button delete"
                pTooltip="Delete Booking" 
                tooltipPosition="top" 
                (click)="onDeleteBooking(booking)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center py-4">
            <div *ngIf="!loading" class="text-gray-500">
              <i class="pi pi-inbox text-4xl mb-2"></i>
              <p>No recent bookings found</p>
            </div>
            <div *ngIf="loading" class="text-gray-500">
              <i class="pi pi-spinner pi-spin text-4xl mb-2"></i>
              <p>Loading bookings...</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Payouts Section -->
  <div class="section">
    <div class="section-header">
      <h2>Recent Payouts</h2>
      <span class="text-sm text-gray-500" *ngIf="payouts.length > 0">
        Showing {{payouts.length}} recent payouts
      </span>
    </div>
    <p-table 
      [value]="payouts" 
      [tableStyle]="{'min-width': '60rem'}" 
      styleClass="p-datatable-gridlines" 
      responsiveLayout="scroll"
      [loading]="loading"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>PAYOUT ID</th>
          <th>CLEANER</th>
          <th>PAYOUT METHOD</th>
          <th>AMOUNT</th>
          <th>STATUS</th>
          <th>ACTIONS</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-payout>
        <tr>
          <td>
            <a class="clickable-bold" (click)="onPayoutClick(payout.payout_id)">
              {{payout.payout_id}}
            </a>
          </td>
          <td>
            <div>
              <div class="font-semibold">{{payout.cleaner_name}}</div>
              <div class="text-sm text-gray-500">{{payout.cleaner_email}}</div>
            </div>
          </td>
          <td>{{payout.payment_method}}</td>
          <td class="amount-column">{{formatAmount(payout.amount)}}</td>
          <td>
            <p-tag 
              [value]="getPayoutStatusDisplay(payout)" 
              [severity]="statusSeverity[payout.status]"
            ></p-tag>
          </td>
          <td>
            <div class="action-buttons">
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-eye" 
                class="p-button-text p-button-sm action-button view" 
                pTooltip="View Details" 
                tooltipPosition="top" 
                (click)="onViewPayout(payout)"
              ></button>
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-pencil" 
                class="p-button-text p-button-sm action-button edit"
                pTooltip="Edit Payout" 
                tooltipPosition="top" 
                (click)="onEditPayout(payout)"
              ></button>
              <button 
                pButton 
                pRipple 
                type="button" 
                icon="pi pi-trash" 
                class="p-button-text p-button-sm action-button delete"
                pTooltip="Delete Payout" 
                tooltipPosition="top" 
                (click)="onDeletePayout(payout)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center py-4">
            <div *ngIf="!loading" class="text-gray-500">
              <i class="pi pi-inbox text-4xl mb-2"></i>
              <p>No recent payouts found</p>
            </div>
            <div *ngIf="loading" class="text-gray-500">
              <i class="pi pi-spinner pi-spin text-4xl mb-2"></i>
              <p>Loading payouts...</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>