<div class="min-h-screen bg-gray-50 p-6">
  <!-- Header Section -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Dispute Management</h1>
    <p class="text-gray-600 text-lg">Here's what's happening with your cleaning services today</p>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <!-- Total Disputes -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
      <div class="text-center">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Total Disputes</p>
        <p class="text-3xl font-bold text-gray-900">{{ stats.totalDisputes }}</p>
      </div>
    </div>

    <!-- Pending -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
      <div class="text-center">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Pending</p>
        <p class="text-3xl font-bold text-amber-600">{{ stats.pending }}</p>
      </div>
    </div>

    <!-- Resolved -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
      <div class="text-center">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Resolved</p>
        <p class="text-3xl font-bold text-green-600">{{ stats.resolved }}</p>
      </div>
    </div>

    <!-- High Priority -->
    <div class="bg-white rounded-xl shadow-sm border-l-4 border-l-red-500 border border-gray-200 p-6 hover:shadow-md transition-shadow">
      <div class="text-center">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">High Priority</p>
        <p class="text-3xl font-bold text-red-600">{{ stats.highPriority }}</p>
      </div>
    </div>
  </div>

  <!-- Active Disputes Card -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-8">
    <!-- Card Header -->
    <div class="px-6 py-4 border-b border-gray-200">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <h3 class="text-xl font-semibold text-gray-900">Active Disputes</h3>
        <div class="relative w-full sm:w-64">
          <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          <input 
            type="text" 
            pInputText 
            placeholder="Search by ID or Name" 
            [(ngModel)]="searchText"
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>
      </div>
    </div>

    <!-- Table -->
    <p-table 
      [value]="filteredDisputes" 
      [paginator]="true" 
      [rows]="5"
      [rowsPerPageOptions]="[5, 10, 20]"
      styleClass="custom-table"
      [tableStyle]="{'min-width': '1000px'}"
    >
      <ng-template pTemplate="header">
        <tr class="bg-gray-50">
          <th class="text-left p-4 font-semibold text-gray-700 uppercase text-xs">DISPUTE ID</th>
          <th class="text-left p-4 font-semibold text-gray-700 uppercase text-xs">CLIENT</th>
          <th class="text-left p-4 font-semibold text-gray-700 uppercase text-xs">REASON</th>
          <th class="text-left p-4 font-semibold text-gray-700 uppercase text-xs">COMMENT</th>
          <th class="text-left p-4 font-semibold text-gray-700 uppercase text-xs">STATUS</th>
          <th class="text-left p-4 font-semibold text-gray-700 uppercase text-xs">ACTION</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-dispute>
        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
          <!-- Dispute ID -->
          <td class="p-4">
            <a 
              (click)="showDisputeDetails(dispute)"
              class="text-blue-600 hover:text-blue-800 font-mono font-bold underline cursor-pointer transition-colors"
            >
              {{ dispute.id }}
            </a>
          </td>
          
          <!-- Client -->
          <td class="p-4">
            <div>
              <p class="font-medium text-gray-900">{{ dispute.client }}</p>
              <p class="text-sm text-gray-500">Cleaner: {{ dispute.cleaner }}</p>
            </div>
          </td>
          
          <!-- Reason -->
          <td class="p-4">
            <div>
              <p class="font-medium text-gray-900">{{ dispute.reason }}</p>
              <p class="text-sm text-gray-500">{{ dispute.serviceProvided }}</p>
            </div>
          </td>
          
          <!-- Comment -->
          <td class="p-4">
            <p class="text-gray-700 line-clamp-2" [title]="dispute.comment">{{ dispute.comment }}</p>
          </td>
          
          <!-- Status -->
          <td class="p-4">
            <div class="flex flex-col gap-2">
              <p-tag 
                [value]="dispute.status" 
                [severity]="getStatusSeverity(dispute.status)"
                class="text-xs font-semibold"
              ></p-tag>
              <p-tag 
                [value]="dispute.priority" 
                [severity]="getPrioritySeverity(dispute.priority)"
                class="text-xs"
              ></p-tag>
            </div>
          </td>
          
          <!-- Action -->
          <td class="p-4">
            <div class="flex gap-2">
              <button 
                pButton 
                icon="pi pi-eye" 
                class="p-button-outlined p-button-sm p-button-secondary"
                (click)="showDisputeDetails(dispute)"
                title="View Details"
              ></button>
              <button 
                pButton 
                icon="pi pi-pound" 
                class="p-button-outlined p-button-sm p-button-success"
                (click)="showRefundDialog(dispute)"
                [disabled]="dispute.status !== 'Pending'"
                title="Process Refund"
                *ngIf="dispute.status === 'Pending'"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="p-8 text-center text-gray-500">
            <i class="pi pi-inbox text-4xl text-gray-300 mb-2"></i>
            <p class="text-lg">No disputes found</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Dispute Details Dialog -->
  <p-dialog 
    header="Dispute Details" 
    [(visible)]="disputeDialog" 
    [style]="{width: '600px', 'max-width': '95vw'}"
    [modal]="true"
    [dismissableMask]="true"
    styleClass="dispute-dialog"
  >
    <div *ngIf="selectedDispute" class="space-y-6">
      <!-- Header -->
      <div class="text-center border-b border-gray-200 pb-4">
        <h3 class="text-lg font-semibold text-gray-900">Dispute #{{ selectedDispute.id }}</h3>
        <p class="text-sm text-gray-500">Created: {{ formatDate(selectedDispute.createdDate) }}</p>
      </div>

      <!-- Details Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Client Name</label>
          <p class="text-lg font-semibold text-gray-900">{{ selectedDispute.client }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Cleaner Name</label>
          <p class="text-lg font-semibold text-gray-900">{{ selectedDispute.cleaner }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Service Provided</label>
          <p class="text-lg font-semibold text-gray-900">{{ selectedDispute.serviceProvided }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Dispute Reason</label>
          <p class="text-lg font-semibold text-gray-900">{{ selectedDispute.reason }}</p>
        </div>
      </div>

      <!-- Comment -->
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-2">Comment</label>
        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
          <p class="text-gray-700 leading-relaxed">{{ selectedDispute.comment }}</p>
        </div>
      </div>

      <!-- Service Fee -->
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">Service Fee Charged</label>
        <p class="text-2xl font-bold text-gray-900">£{{ selectedDispute.serviceFee }}</p>
      </div>

      <!-- Refund Amount if exists -->
      <div *ngIf="selectedDispute.refundAmount">
        <label class="block text-sm font-medium text-gray-500 mb-1">Refunded Amount</label>
        <p class="text-xl font-bold text-green-600">£{{ selectedDispute.refundAmount }}</p>
      </div>

      <!-- Status -->
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-2">Current Status</label>
        <p-tag 
          [value]="selectedDispute.status" 
          [severity]="getStatusSeverity(selectedDispute.status)"
          class="text-sm font-semibold px-3 py-2"
        ></p-tag>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-3 pt-4 border-t border-gray-200" *ngIf="selectedDispute.status === 'Pending'">
        <button 
          pButton 
          icon="pi pi-check" 
          label="Resolve" 
          class="p-button-success flex-1"
          (click)="resolveDispute()"
        ></button>
        <button 
          pButton 
          icon="pi pi-times" 
          label="Cancel" 
          class="p-button-danger flex-1"
          (click)="cancelDispute()"
        ></button>
        <button 
          pButton 
          icon="pi pi-pound" 
          label="Refund" 
          class="p-button-warning flex-1"
          (click)="showRefundDialog(selectedDispute)"
        ></button>
      </div>

      <div *ngIf="selectedDispute.status === 'Resolved'" class="text-center">
        <p-tag 
          icon="pi pi-check-circle" 
          value="Dispute Resolved" 
          severity="success" 
          class="text-sm font-semibold px-4 py-2"
        ></p-tag>
        <p class="text-sm text-gray-500 mt-2">Resolved on: {{ formatDate(selectedDispute.resolvedDate!) }}</p>
      </div>
    </div>
  </p-dialog>

  <!-- Refund Dialog -->
  <p-dialog 
    header="Refund Amount" 
    [(visible)]="refundDialog" 
    [style]="{width: '500px', 'max-width': '95vw'}"
    [modal]="true"
    [dismissableMask]="true"
    styleClass="refund-dialog"
  >
    <div *ngIf="selectedDispute" class="space-y-6">
      <div class="text-center">
        <h4 class="text-lg font-semibold text-gray-900 mb-2">Process Refund for Dispute #{{ selectedDispute.id }}</h4>
        <p class="text-gray-600">Service Fee: <span class="font-semibold">£{{ selectedDispute.serviceFee }}</span></p>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-3">Refunded Amount (£)</label>
        <input 
          type="number" 
          [(ngModel)]="refundAmount"
          [max]="selectedDispute.serviceFee"
          [min]="0"
          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg font-semibold"
        />
        <p class="text-sm text-gray-500 mt-2">Maximum refundable amount: £{{ selectedDispute.serviceFee }}</p>
      </div>

      <div class="flex gap-3 pt-4">
        <button 
          pButton 
          icon="pi pi-arrow-left" 
          label="Back" 
          class="p-button-secondary flex-1"
          (click)="refundDialog = false; disputeDialog = true"
        ></button>
        <button 
          pButton 
          icon="pi pi-check" 
          label="Confirm Refund" 
          class="p-button-success flex-1"
          (click)="confirmRefund()"
          [disabled]="refundAmount <= 0 || refundAmount > selectedDispute.serviceFee"
        ></button>
      </div>
    </div>
  </p-dialog>
</div>