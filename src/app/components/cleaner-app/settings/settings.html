<div class="settings-container">
  <!-- Toast for messages -->
  <p-toast></p-toast>

  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-spinner">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      <p>Loading profile data...</p>
    </div>
  </div>

  <!-- Header -->
  <div class="header-section">
    <h1>Cleaner Profile</h1>
    <p class="subtitle">Manage your personal information and settings</p>
  </div>

  <div class="settings-content">
    <!-- Left Column -->
    <div class="left-column">
      <!-- Profile Upload Section -->
      <p-card class="upload-card">
        <div class="upload-section">
          <div class="profile-picture-container">
            <img [src]="profilePictureUrl" alt="Profile Picture" class="profile-picture">
            <div class="profile-overlay" (click)="fileInput.click()">
              <i class="pi pi-camera"></i>
              <span>Change Photo</span>
            </div>
          </div>
          <div class="upload-header">
            <i class="pi pi-cloud-upload upload-icon"></i>
            <h3>Upload Profile Picture</h3>
          </div>
          <div class="file-upload-wrapper">
            <input 
              #fileInput
              type="file" 
              id="fileInput"
              (change)="onFileSelected($event)"
              accept="image/*"
              class="file-input"
              [disabled]="loading">
            <label for="fileInput" class="file-upload-label" [class.disabled]="loading">
              <i class="pi pi-upload"></i>
              {{ loading ? 'Uploading...' : 'Choose File' }}
            </label>
          </div>
          <small class="file-hint">
            {{ selectedFile ? selectedFile.name : 'No files chosen' }}
          </small>
          <small class="file-info">Supported formats: JPG, PNG, GIF â€¢ Max size: 5MB</small>
        </div>
      </p-card>

      <!-- Personal Information -->
      <p-card class="info-card">
        <div class="section-header">
          <h3>Personal Information</h3>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input 
              id="firstName"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.firstName"
              [disabled]="loading"
              class="form-input"
              placeholder="Enter first name">
          </div>

          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input 
              id="lastName"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.lastName"
              [disabled]="loading"
              class="form-input"
              placeholder="Enter last name">
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input 
              id="email"
              type="email" 
              pInputText 
              [(ngModel)]="profileData.email"
              [disabled]="true"
              class="form-input disabled">
            <small class="field-hint">Email cannot be changed</small>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number *</label>
            <input 
              id="phone"
              type="tel" 
              pInputText 
              [(ngModel)]="profileData.phone"
              [disabled]="loading"
              class="form-input"
              placeholder="+1234567890">
          </div>
        </div>
      </p-card>

      <!-- Password Section -->
      <p-card class="info-card">
        <div class="section-header">
          <h3>Change Password</h3>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="password">New Password</label>
            <input 
              id="password"
              type="password" 
              pInputText 
              [(ngModel)]="profileData.password"
              [disabled]="loading"
              placeholder="Enter new password"
              class="form-input">
          </div>

          <div class="form-group">
            <label for="repeatPassword">Repeat Password</label>
            <input 
              id="repeatPassword"
              type="password" 
              pInputText 
              [(ngModel)]="profileData.repeatPassword"
              [disabled]="loading"
              placeholder="Repeat new password"
              class="form-input">
          </div>
        </div>
        <small class="field-hint">Leave blank to keep current password</small>
      </p-card>
    </div>

    <!-- Right Column -->
    <div class="right-column">
      <!-- Address Information -->
      <p-card class="info-card">
        <div class="section-header">
          <h3>Address Information</h3>
        </div>
        
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="buildingNumber">Building Number and Street Name *</label>
            <input 
              id="buildingNumber"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.buildingNumber"
              [disabled]="loading"
              class="form-input"
              placeholder="123 Main St">
          </div>

          <div class="form-group">
            <label for="locality">Locality Name (optional)</label>
            <input 
              id="locality"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.locality"
              [disabled]="loading"
              class="form-input"
              placeholder="Optional locality">
          </div>

          <div class="form-group">
            <label for="postTown">City *</label>
            <input 
              id="postTown"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.postTown"
              [disabled]="loading"
              class="form-input"
              placeholder="New York">
          </div>

          <div class="form-group">
            <label for="postcode">Postcode *</label>
            <input 
              id="postcode"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.postcode"
              [disabled]="loading"
              class="form-input"
              placeholder="10001">
          </div>

          <div class="form-group">
            <label for="state">State *</label>
            <input 
              id="state"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.state"
              [disabled]="loading"
              class="form-input"
              placeholder="NY">
          </div>

          <div class="form-group">
            <label for="country">Country *</label>
            <input 
              id="country"
              type="text" 
              pInputText 
              [(ngModel)]="profileData.country"
              [disabled]="loading"
              class="form-input"
              placeholder="USA">
          </div>
        </div>
      </p-card>

      <!-- Payment Information -->
      <p-card class="info-card">
        <div class="section-header">
          <h3>Payment Information</h3>
          <small class="payment-status" *ngIf="currentPaymentMethod">
            {{ currentPaymentMethod.is_default ? 'Default Payment Method' : 'Payment Method' }}
          </small>
        </div>
        
        <div class="payment-options">
          <div class="radio-group">
            <input 
              type="radio" 
              id="paypal"
              name="paymentMethod" 
              value="paypal" 
              [(ngModel)]="profileData.paymentMethod"
              [disabled]="loading"
              class="radio-input">
            <label for="paypal" class="radio-label">PayPal</label>
          </div>

          <div class="radio-group">
            <input 
              type="radio" 
              id="bank"
              name="paymentMethod" 
              value="bank_transfer" 
              [(ngModel)]="profileData.paymentMethod"
              [disabled]="loading"
              class="radio-input">
            <label for="bank" class="radio-label">Bank Transfer</label>
          </div>
        </div>

        <!-- PayPal Form -->
        <div class="form-group" *ngIf="profileData.paymentMethod === 'paypal'">
          <label for="paypalEmail">PayPal Email Address *</label>
          <input 
            id="paypalEmail"
            type="email" 
            pInputText 
            [(ngModel)]="profileData.paypalEmail"
            [disabled]="loading"
            class="form-input"
            placeholder="hello@paypal.com">
        </div>

        <!-- Bank Transfer Form -->
        <div class="bank-form" *ngIf="profileData.paymentMethod === 'bank_transfer'">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="beneficiary">Beneficiary Name *</label>
              <input 
                id="beneficiary"
                type="text" 
                pInputText 
                [(ngModel)]="profileData.beneficiary"
                [disabled]="loading"
                placeholder="Enter beneficiary name"
                class="form-input">
            </div>

            <div class="form-group full-width">
              <label for="bankAddress">Bank Address</label>
              <input 
                id="bankAddress"
                type="text" 
                pInputText 
                [(ngModel)]="profileData.bankAddress"
                [disabled]="loading"
                placeholder="Enter bank address"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="bankName">Bank Name *</label>
              <input 
                id="bankName"
                type="text" 
                pInputText 
                [(ngModel)]="profileData.bankName"
                [disabled]="loading"
                placeholder="Enter bank name"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="sortCode">Sort Code</label>
              <input 
                id="sortCode"
                type="text" 
                pInputText 
                [(ngModel)]="profileData.sortCode"
                [disabled]="loading"
                placeholder="e.g., 013972"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="accountNumber">Account Number *</label>
              <input 
                id="accountNumber"
                type="text" 
                pInputText 
                [(ngModel)]="profileData.accountNumber"
                [disabled]="loading"
                placeholder="Enter account number"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="iban">IBAN</label>
              <input 
                id="iban"
                type="text" 
                pInputText 
                [(ngModel)]="profileData.iban"
                [disabled]="loading"
                placeholder="Enter IBAN"
                class="form-input">
            </div>
          </div>
        </div>
      </p-card>

      <!-- Save Button -->
      <div class="action-section">
        <p-button 
          label="{{ loading ? 'Saving...' : 'Save Changes' }}" 
          icon="pi pi-check"
          (click)="saveChanges()"
          [disabled]="loading"
          styleClass="save-button">
        </p-button>
      </div>
    </div>
  </div>
</div>