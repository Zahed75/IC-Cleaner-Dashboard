<div class="reports-container">
  <!-- Toast for messages -->
  <p-toast></p-toast>

  <!-- Header -->
  <div class="header-section">
    <div class="header-content">
      <h1>Reports & Analytics</h1>
      <p class="subtitle">Here's what's happening with your cleaning services today</p>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <p-card class="filters-card">
      <div class="filters-content">
        <div class="filter-group">
          <label>Date Range</label>
          <p-select 
            [options]="dateRangeOptions" 
            [(ngModel)]="selectedDateRange"
            optionLabel="label"
            (onChange)="onFilterChange()"
            styleClass="w-full">
          </p-select>
        </div>
        
        <div class="filter-group">
          <label>Service Type</label>
          <p-select 
            [options]="serviceTypeOptions" 
            [(ngModel)]="selectedServiceType"
            optionLabel="label"
            (onChange)="onFilterChange()"
            styleClass="w-full">
          </p-select>
        </div>
        
        <div class="filter-group">
          <label>Location</label>
          <p-select 
            [options]="locationOptions" 
            [(ngModel)]="selectedLocation"
            optionLabel="label"
            (onChange)="onFilterChange()"
            styleClass="w-full">
          </p-select>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Stats Cards -->
  <div class="stats-section">
    <div class="stats-grid">
      <!-- Total Bookings -->
      <p-card class="stat-card bookings-card">
        <div class="stat-content">
          <div class="stat-header">
            <i class="pi pi-calendar stat-icon"></i>
            <h3>Total Bookings</h3>
          </div>
          <div class="stat-numbers">
            <span class="total">{{ getTotalBookings() }}</span>
            <div class="trend" [class]="getBookingsTrend()">
              <i class="pi" [class]="getBookingsTrend() === 'positive' ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
              <span>{{ getBookingsDelta() }}</span>
            </div>
          </div>
        </div>
      </p-card>

      <!-- Revenue -->
      <p-card class="stat-card revenue-card">
        <div class="stat-content">
          <div class="stat-header">
            <i class="pi pi-wallet stat-icon"></i>
            <h3>Revenue</h3>
          </div>
          <div class="stat-numbers">
            <span class="total amount">{{ getRevenue() }}</span>
            <div class="trend" [class]="getRevenueTrend()">
              <i class="pi" [class]="getRevenueTrend() === 'positive' ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
              <span>{{ getRevenueDelta() }}</span>
            </div>
          </div>
        </div>
      </p-card>

      <!-- Average Rating -->
      <p-card class="stat-card rating-card">
        <div class="stat-content">
          <div class="stat-header">
            <i class="pi pi-star stat-icon"></i>
            <h3>Avg. Rating</h3>
          </div>
          <div class="stat-numbers">
            <span class="total rating">{{ getAverageRating() }}</span>
            <div class="rating-details">
              <span class="positive-rate">{{ getPositiveRate() }}</span>
              <div class="stars">
                <!-- Fixed: Use numericRating instead of parseFloat in template -->
                <ng-container *ngIf="getNumericRating() > 0; else noRating">
                  <i *ngFor="let star of [].constructor(getStars(getNumericRating()).full)" 
                     class="pi pi-star-fill"></i>
                  <i *ngIf="getStars(getNumericRating()).half" 
                     class="pi pi-star-half"></i>
                  <i *ngFor="let star of [].constructor(getStars(getNumericRating()).empty)" 
                     class="pi pi-star"></i>
                </ng-container>
                <ng-template #noRating>
                  <i class="pi pi-star" *ngFor="let star of [1,2,3,4,5]"></i>
                </ng-template>
              </div>
            </div>
          </div>
        </div>
      </p-card>

      <!-- Active Disputes -->
      <p-card class="stat-card disputes-card">
        <div class="stat-content">
          <div class="stat-header">
            <i class="pi pi-exclamation-triangle stat-icon"></i>
            <h3>Active Disputes</h3>
          </div>
          <div class="stat-numbers">
            <span class="total">{{ getActiveDisputes() }}</span>
            <div class="trend" [class]="getDisputesTrend()">
              <i class="pi" [class]="getDisputesTrend() === 'positive' ? 'pi-arrow-down' : 'pi-arrow-up'"></i>
              <span>{{ getDisputesDelta() }}</span>
            </div>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="charts-grid">
      <!-- Revenue Overview Chart -->
      <p-card header="Revenue Overview" class="chart-card">
        <div class="chart-content">
          <p-chart 
            type="line" 
            [data]="revenueData" 
            [options]="revenueOptions"
            [style]="{'height': '300px'}">
          </p-chart>
        </div>
      </p-card>

      <!-- Service Distribution Chart -->
      <p-card header="Service Distribution" class="chart-card">
        <div class="chart-content">
          <p-chart 
            type="bar" 
            [data]="serviceData" 
            [options]="serviceOptions"
            [style]="{'height': '300px'}">
          </p-chart>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-spinner">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      <p>Loading reports data...</p>
    </div>
  </div>
</div>